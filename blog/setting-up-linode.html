<!DOCTYPE html>
<html>
    <head>
        <title>Setting Up Linode For The Impatient - Gouthaman Balaraman</title>
        <!-- All the meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Setting Up Linode For The Impatient"/>
        <meta property="og:url" content="http://gouthamanbalaraman.com/blog/setting-up-linode.html"/>
        <meta property="og:description" content="Some notes based on my experience setting up the linode server"/>
        <!--link href="http://gouthamanbalaraman.com/theme/static/css/journal-bootstrap.min.css" rel="stylesheet" /-->
        <link href="http://gouthamanbalaraman.com/theme/static/css/bootstrap.readable.min.css" rel="stylesheet" />
        <link href="http://gouthamanbalaraman.com/theme/static/css/style.css" rel="stylesheet" />
        
        <!-- Google Analytics -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46714334-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    /*Update Your Analytics Tracking Code to Support Display Advertising by uncommenting the following 
    instead of the above line */    
    /*ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';*/
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
        <!-- Using MathJax, with the delimiters $ -->
        <!-- Conflict with pygments for the .mo and .mi -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          "HTML-CSS": {
          styles: {
          ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
          },
          tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']],processEscapes: true}
          });
        </script>

        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>

    
    </head>

    <body>
      <div class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <a href="http://gouthamanbalaraman.com" class="navbar-brand">Gouthaman Balaraman</a>
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="navbar-collapse collapse" id="navbar-main">
              <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://gouthamanbalaraman.com/pages/about.html">About</a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-md-10 col-md-offset-1">
    <div class="page-header">
        <h1>Setting Up Linode For The Impatient</h1>
     <!--span class="glyphicon glyphicon-calendar"></span-->&nbsp;November 13, 2014 
     &nbsp;&nbsp;
     <!--span class="glyphicon glyphicon-user"></span--> by  
     <a class="url fn" href="http://gouthamanbalaraman.com/author/gouthaman-balaraman.html">&nbsp;Gouthaman Balaraman </a>
     </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-10 col-md-offset-1">

<div class="bs-docs-section">
    
     <!-- article description -->
         <p class="lead">Some notes based on my experience setting up the linode server</p>
      
      <!-- article content -->
     <p>When you get a linode instance, you really get a barren (sort of) linux machine on the cloud. That means
you have to take care of customizing the server based on your needs. Here are some notes based on what I
wanted to setup.</p>
<p>My requirements were the following:</p>
<ul class="simple">
<li>Python Setup: Setup python to perform installations using <tt class="docutils literal">pip</tt>.</li>
<li>Secure Server: Enable firewall etc.</li>
</ul>
<div class="section" id="linode-basics">
<h2>Linode Basics</h2>
<ul>
<li><p class="first">Once I setup the linode account, I used the ssh instructions on the &quot;Remote Access&quot; in the linode
dashboard to get the IP as:</p>
<pre class="literal-block">
ssh root&#64;&lt;ip-address&gt;
</pre>
</li>
<li><p class="first">Setup hostname:</p>
<pre class="literal-block">
echo &quot;ServerName&quot; &gt; /etc/hostname
hostname -F /etc/hostname
</pre>
<p>Try <tt class="docutils literal">hostname</tt> on the command line to see the hostname printed correctly.</p>
</li>
<li><p class="first">Add to /etc/hosts. In your <em>desktop</em>, associate the linode IP with a custom servername of
your liking. Edit /etc/hosts to look like:</p>
<pre class="literal-block">
127.0.0.1   localhost
127.0.1.1   G-ubuntu
111.11.11.1 ServerName
</pre>
<p>Also on you linode add an entry to associate <tt class="docutils literal">127.0.0.1</tt> with the server hostname. If not you will
a error message that the &lt;ServerName is not recognized when you <tt class="docutils literal">sudo</tt>. Add the following to /etc/hostname
in your linode:</p>
<pre class="literal-block">
127.0.0.1  ServerName
</pre>
</li>
</ul>
</div>
<div class="section" id="securing-linode">
<h2>Securing Linode</h2>
<ul>
<li><p class="first">Setting up firewall: When I type <tt class="docutils literal">sudo iptables <span class="pre">-L</span></tt> I get:</p>
<pre class="literal-block">
Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
</pre>
<p>Now create a file to store the firewall rules using <tt class="docutils literal">sudo nano /etc/iptables.firewall.rules</tt> and
paste the following:</p>
<pre class="literal-block">
*filter

#  Allow all loopback (lo0) traffic and drop all traffic to 127/8 that doesn't use lo0
-A INPUT -i lo -j ACCEPT
-A INPUT -d 127.0.0.0/8 -j REJECT

#  Accept all established inbound connections
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT

#  Allow all outbound traffic - you can modify this to only allow certain traffic
-A OUTPUT -j ACCEPT

#  Allow HTTP and HTTPS connections from anywhere (the normal ports for websites and SSL).
-A INPUT -p tcp --dport 80 -j ACCEPT
-A INPUT -p tcp --dport 443 -j ACCEPT

#  Allow SSH connections
#
#  The -dport number should be the same port number you set in sshd_config
#
-A INPUT -p tcp -m state --state NEW --dport 22 -j ACCEPT

#  Allow ping
-A INPUT -p icmp --icmp-type echo-request -j ACCEPT

#  Log iptables denied calls
-A INPUT -m limit --limit 5/min -j LOG --log-prefix &quot;iptables denied: &quot; --log-level 7

#  Drop all other inbound - default deny unless explicitly allowed policy
-A INPUT -j DROP
-A FORWARD -j DROP

COMMIT
</pre>
<p>Now the firewall rules can be activated using:</p>
<pre class="literal-block">
sudo iptables-restore &lt; /etc/iptables.firewall.rules
</pre>
<p>Now when you type <tt class="docutils literal">sudo iptables <span class="pre">-L</span></tt>:</p>
<pre class="literal-block">
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
REJECT     all  --  anywhere             127.0.0.0/8          reject-with icmp-port-unreachable
ACCEPT     all  --  anywhere             anywhere             state RELATED,ESTABLISHED
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:http
ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https
ACCEPT     tcp  --  anywhere             anywhere             state NEW tcp dpt:ssh
ACCEPT     icmp --  anywhere             anywhere
LOG        all  --  anywhere             anywhere             limit: avg 5/min burst 5 LOG level debug prefix &quot;iptables denied: &quot;
DROP       all  --  anywhere             anywhere

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination
DROP       all  --  anywhere             anywhere

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     all  --  anywhere             anywhere
</pre>
<p>Now to ensure that the firewall is going to be up and running every time you reboot your
Linode, edit <tt class="docutils literal"><span class="pre">/etc/network/if-pre-up.d/firewall</span></tt> as <tt class="docutils literal">sudo</tt> to add:</p>
<pre class="literal-block">
#!/bin/sh
/sbin/iptables-restore &lt; /etc/iptables.firewall.rules
</pre>
<p>Once you have saved these edits, make this file executable using:</p>
<pre class="literal-block">
sudo chmod +x /etc/network/if-pre-up.d/firewall
</pre>
<p>This should secure your server. If you want to make sure your firewall is up and running,
reboot the server and check what you get when you type <tt class="docutils literal">sudo iptables <span class="pre">-L</span></tt>.</p>
</li>
<li><p class="first">Installing and Configuring Fail2Ban: Fail2Ban is an application that prevents
dictionary attacks on your server. When Fail2Ban detects multiple failed login
attempts from the same IP address, it creates temporary firewall rules that block
traffic from the attacker’s IP address. Attempted logins can be monitored on a
variety of protocols, including SSH, HTTP, and SMTP. By default, Fail2Ban monitors SSH only.</p>
<p>Here’s how to install and configure Fail2Ban:</p>
<ul>
<li><p class="first">Install Fail2Ban by entering the following command:</p>
<pre class="literal-block">
sudo apt-get install fail2ban
</pre>
</li>
<li><p class="first">Optionally, you can override the default Fail2Ban configuration by creating
a new <tt class="docutils literal">jail.local</tt> file. Enter the following command to create the file:</p>
<pre class="literal-block">
sudo nano /etc/fail2ban/jail.local
</pre>
</li>
<li><p class="first">To learn more about Fail2Ban configuration options, see this article on the <a class="reference external" href="http://www.fail2ban.org/wiki/index.php/MANUAL_0_8#Configuration">Fail2Ban</a> website.
Fail2Ban is now installed and running on your Linode. It will monitor your log files for failed
login attempts. After an IP address has exceeded the maximum number of authentication attempts,
it will be blocked at the network level and the event will be logged in <tt class="docutils literal">/var/log/fail2ban.log</tt>.</p>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="python-setup">
<h2>Python Setup</h2>
<ul class="simple">
<li></li>
</ul>
</div>

     <br>
     
     <!-- article tags-->
        <span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;
            <span class="label label-default"><a href="http://gouthamanbalaraman.com/tag/programming.html">programming</a></span>&nbsp;&nbsp;
            <span class="label label-default"><a href="http://gouthamanbalaraman.com/tag/linux.html">linux</a></span>&nbsp;&nbsp;
        <br>
     <hr/>
    
    <strong>Related Post</strong>
        <ul>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/zeo-as-a-windows-service.html">Running ZEO as a Windows Service</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/minimal-lua-c-example.html">Minimal Lua C++ Example</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/python-multiprocessing-as-a-task-queue.html">Python Multiprocessing as a Task Queue</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/minimal-example-lua-function-cpp.html">Minimal Example of Calling Lua Functions from C++</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/flask-track-usage.html">Flask Track Usage Primer</a>
            </li>
        </ul>
        <hr/>

     <!-- article comments -->
    <div class="comment">
        <div id="disqus_thread"></div> <!-- comment app container -->
    </div>
	<!-- Comment BEGIN -->
    <script type="text/javascript">
        var disqus_shortname = 'gouthamanbalaramancom'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
     <!-- Comment END -->
</div>    
                </div>
               
            </div>
            <div class="row">
                <div class="col-md-10 col-md-offset-1">
                </div>
            </div>
            <footer id="contentinfo" class="footer">
                    <address id="about" class="vcard body">
                    &copy; <a href="http://gouthamanbalaraman.com">Gouthaman Balaraman</a> Proudly powered by <a href="http://getpelican.com/">Pelican</a>
                    </address><!-- /#about -->
            </footer><!-- /#contentinfo -->
        </div><!-- container -->
    </body>
</html>