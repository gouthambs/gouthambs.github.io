<!DOCTYPE html>
<html>
    <head>
        <title>How to Build a Fundamental Factor Model - G B</title>
        <!-- All the meta tags -->
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="How to Build a Fundamental Factor Model"/>
        <meta property="og:url" content="http://gouthamanbalaraman.com/blog/build-fundamental-factor-model.html"/>
        <meta property="og:description" content="This post outlines the methodology behind building a fundamental factor model."/>
        <link href="http://gouthamanbalaraman.com/theme/static/css/bootstrap.readable.min.css" rel="stylesheet" />
        <link href="http://gouthamanbalaraman.com/theme/static/css/style.css" rel="stylesheet" />
        
        <link href="http://gouthamanbalaraman.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="G B Full Atom Feed" />
        <link href="http://gouthamanbalaraman.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="G B RSS Feed" />
        <link href="http://gouthamanbalaraman.com/feeds/finance.atom.xml" type="application/atom+xml" rel="alternate" title="G B Categories Atom Feed" />
        <link href="http://gouthamanbalaraman.com/feeds/finance.rss.xml" type="application/rss+xml" rel="alternate" title="G B Categories RSS Feed" />
        <!-- Google Analytics -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-46714334-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    /*Update Your Analytics Tracking Code to Support Display Advertising by uncommenting the following 
    instead of the above line */    
    /*ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';*/
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
        <!-- Using MathJax, with the delimiters $ -->
        <!-- Conflict with pygments for the .mo and .mi -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          "HTML-CSS": {
          styles: {
          ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
          },
          tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']],processEscapes: true}
          });
        </script>
    </head>

    <body>
      <div class="navbar navbar-default navbar-fixed-top">
          <div class="container">
            <div class="navbar-header">
              <a href="http://gouthamanbalaraman.com" class="navbar-brand">G B</a>
              <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
            <div class="navbar-collapse collapse" id="navbar-main">
              <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://gouthamanbalaraman.com/pages/about.html">About</a>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="container">
            <div class="row">
                <div class="col-md-10 col-md-offset-1">
    <div class="page-header">
        <h1>How to Build a Fundamental Factor Model</h1>
     <!--span class="glyphicon glyphicon-calendar"></span-->
     &nbsp;June 22, 2015
     &nbsp;
     <!--span class="glyphicon glyphicon-user"></span--> by  
     <a class="url fn" href="http://gouthamanbalaraman.com/author/gouthaman-balaraman.html">&nbsp;Gouthaman Balaraman </a>

        <p id="post-share-links">
            &nbsp;Share on:
            <a href="https://sharetodiaspora.github.io/?title=How%20to%20Build%20a%20Fundamental%20Factor%20Model&url=http%3A//gouthamanbalaraman.com/blog/build-fundamental-factor-model.html" target="_blank" title="Share on Diaspora">Diaspora*</a>
            /
            <a href="http://twitter.com/home?status=How%20to%20Build%20a%20Fundamental%20Factor%20Model by @gsbalaraman%20http%3A//gouthamanbalaraman.com/blog/build-fundamental-factor-model.html" target="_blank" title="Share on Twitter">Twitter</a>
            /
            <a href="http://www.facebook.com/sharer/sharer.php?s=100&amp;p%5Burl%5D=http%3A//gouthamanbalaraman.com/blog/build-fundamental-factor-model.html" target="_blank" title="Share on Facebook">Facebook</a>
            /
            <a href="https://plus.google.com/share?url=http%3A//gouthamanbalaraman.com/blog/build-fundamental-factor-model.html" target="_blank" title="Share on Google Plus">Google+</a>
            /
            <a href="mailto:?subject=How%20to%20Build%20a%20Fundamental%20Factor%20Model&amp;body=http%3A//gouthamanbalaraman.com/blog/build-fundamental-factor-model.html" target="_blank" title="Share via Email">Email</a>
            /
            <a href="http://www.bloglovin.com/blog/14559547/?claim=cqravg9v4n2">Bloglovin</a>
        </p>
     </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-10 col-md-offset-1">

<div class="bs-docs-section">
    
     <!-- article description -->
         <p class="lead">This post outlines the methodology behind building a fundamental factor model.</p>
      
      <!-- article content -->
     <p>In a multi-factor model, the return of a stock can be broken out 
into multiple factors.</p>
<p>$$ r_i = \alpha_i + \sum_{j=1}^{K} \beta_{ij} f_j + \epsilon_i $$</p>
<p>The term $\epsilon_i$ is the error term which is assumed to have a 
distribution with zero mean. Now we can write the average return as</p>
<p>$$ E(r_i) = E(\alpha_i) + \sum_{j=1}^{K} \beta_{ij} E(f_j) $$</p>
<p>This can be expressed concisely using the matrix representation:</p>
<p>$$ r_i = \mathbf{\beta}^T_i \mathbf{f}  + \epsilon_i $$</p>
<p>where:</p>
<p>\begin{eqarray}
\mathbf{\beta}<em i1="i1">i &amp;=&amp; (\alpha_i, \beta</em>, \beta_{i2}, ..., \beta_{iK})^T \ 
\mathbf(f) &amp;=&amp; (1, f_1, f_2, ..., f_K)^T
\end{eqarray}</p>
<p>Using this notation, the average return can then be written as:</p>
<p>$$ E(r_i) = \mathbf{\beta}_i^T E(\mathbf{f}) $$</p>
<p>We see that the average return on the stock is the product of factor exposures ($\mathbf{\beta}_i$) and factor premium ($\mathbf{f}$). In a fundamental factor model, the <em>factor exposures</em>  are characteristics of an investment (such as a stock) that is known, such as the Price to Earnings ratio, or momentum of the stock, or market capitalization. The <em>factor premium</em> is the unknown that we wish to determine empirically. </p>
<p>One of the tenets of quantitative portfolio management is:
<em>the average return of an investment is the payoff
for taking risk</em>. The risk of a stock has two components:</p>
<p>Total Risk = Non-Diversifiable Risk + Diversifiable Risk</p>
<p>Risk can be measured using the variance of the returns:</p>
<p>$$ V(r_i) = V(\alpha + \beta_{i1}f_1 + ... + \beta_{iK}f_K) + V(\epsilon_i) + V(\epsilon_i)$$.</p>
<p>This can be expressed in the matrix notation as:</p>
<p>$$ V(r_i) = \mathbf{\beta}_i^T V(\mathbf{f}) \mathbf{\beta}_i + V(\epsilon_i) $$</p>
<p>where $V(\mathbf{f})$ is a $(K+1) \times (K+1)$-dimensional variance-covariance matrix. The diversifiable component which an investor can mitigate by diversification
is the term $V(\epsilon_i)$. The non-diversifiable componenent which the market 
rewards is obtained from factor exposures $\mathbf{\beta}_i$ and factor premium
risk $V(\mathbf{f})$.</p>
<h2>Preparatory Work</h2>
<p>There are a series of steps that one has to do before we can run a 
multi-variable regression to determine the factor premiums. </p>
<h3>Choosing the factors</h3>
<p>We need to choose the factors that we wish to include in the model. This step 
is usually driven by the intuition an investor has on the market, and 
characteristics of the stock that are important. For instance, some fundamental factors that would make sense for equity investments include:</p>
<ol>
<li><em>Valuation Factors</em>: Market capitalization (size), price-to-book ratio (P/B),
price-to-earnings ratio (P/E), price-to-sales ratio (P/S).</li>
<li><em>Solvency Factors</em>: Debt-to-equity ratio (D/E), current ratio (CUR, a metric
of short term solvency), interest coverage ratio.</li>
<li><em>Growth Potential Factors</em>: Capital-expenditure-to-sales ratio, R&amp;D-expenditure-to-sales ratio, advertising-expenditure-to-sales ratio.</li>
<li><em>Technical factors</em>: Momentum, trading volume, short interest shares shorted</li>
<li><em>Analyst factors</em>: Analyst rating changes, earnings revision etc.</li>
</ol>
<p>Similarly some fundamental factors that would make sense for fixed income investments 
include:</p>
<ol>
<li><em>Credit Factors</em>: Credit quality, different vendor ratings</li>
<li><em>Interest Rate Sensitivity Factors</em>: Effective duration, key rate duration at
various tenors, convexity</li>
<li><em>Asset Type Factors</em>: Some factors can be asset specific, such as:<ol>
<li><em>Municipals</em>: <ol>
<li>State or issuer</li>
<li>Purpose such as revenue or general obligation</li>
</ol>
</li>
<li><em>Mortgages</em>:<ol>
<li>Coupon</li>
<li>Amortization type</li>
<li>Issuer</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3>Treatment of the Risk-Free Rate</h3>
<p>Since we are building a model to measure the payoff for undertaking risk, it is
conventional to subtract the risk-free rate from the returns of the investment. The
rational is that the risk-free rate is the return that can be obtained on any
investment without any risk. In order to do this, we need to define what is
considered risk-free. In the U.S. markets, the U.S. treasury bills are used
as a proxy for the risk free rate. In other markets, one has to exercise care
in identifying a risk free rate. All sovereign bond/bill  rates do not 
immediately translate into risk-free rates because a lot of countries (developing 
and developed) have risk of default as well. </p>
<p>Once the risk-free rate $r_{ft}$ has been identified, the excess return can be defined
as </p>
<p>$$ r_{it}' = r_{it} - r_{ft} $$</p>
<h3>Building the Data Sample</h3>
<p>One of the crucial components in the factor model building process is 
to create a data sample that can then be used to deduce the model 
parameters. For example, to model the U.S. equity market one can use
the top 2000 to 3000 stocks by market cap. Depending on where we cutoff, 
this will include stocks in the large-cap and mid-cap range. This would mean
that the model may not precisely model the effects in the small-cap stocks.
On the other hand, limiting to stocks in the mid-cap or large-cap range can
provide more stability to the model, and that could be a desirable thing.  </p>
<p>Once we have a filter for deciding how we want to build the basket of 
instruments for model building, we also have to decide the frequency and 
period for which we need to collect the data. What do we mean by that? The
regression step involved in the model building will fit the stock returns
$r_{it}$ for a period (such as one day returns or monthly returns) as 
a function of various factors $f$. The return data is collected over multiple
periods, such as 3 years or 5 years. For instance, our data sample could
be top 3000 stocks by market cap with monthly returns collected for 3 years.
A rule of thumb is that the frequency of the investor's re-balancing strategy
should determine the frequency of the returns used in the model building.
If the re-balances  monthly, then one should use monthly returns in the 
model fitting. There should be sufficient time periods included in order
to avoid spurious fitting effects and to improve robustness of fit. 
It is conventional to use 3 to 5 years worth of data while using monthly 
returns, and 2 to 3 years while using weekly returns.  </p>
<p>Another factor that one should keep in mind is to include companies
that are not only alive at the time of model building but also to include
companies that may have gotten delisted or bankrupt. Failure to do 
so will introduce what is called as <em>survivorship bias</em> in your model. </p>
<h2>Fitting the Model</h2>
<p>Once we have the data sample assembled, one can use regression utilities
in statistical packages such as <em>R</em>, Python's <em>Statsmodels</em> package, <em>Matlab</em>,
SAS to perform a panel regression. The goal of the panel regression is 
to estimate factor premium $\mathbf{f}$ given by the equation </p>
<p>$$ r_i = \mathbf{\beta}^T_i \mathbf{f}  + \epsilon_i $$</p>
<p>where the returns $r_i$ and the factor exposures $\mathbf{\beta}_i$
are known. A simple way to estimate factor premiums is by using 
Ordinary Least Squares (OLS). This will also give us an estimate
of the sample variance-covariance matrix $V(\mathbf{\hat{f}})$.</p>
<p>\begin{eqnarray} 
\mathbf{f} &amp;=&amp; \left( \sum_{t=1}^T \sum_{i=1}^N  (\mathbf{\beta}_{it} - \bar{\mathbf{\beta}} ) (  \mathbf{\beta}_{it} - \bar{\mathbf{\beta}} )^T
\right)^{-1}
  \sum_{t=1}^{T} \sum_{i=1}^{N} (\mathbf{\beta}_{it} - \bar{\mathbf{\beta}} ) (r_{it} - \bar{r})
\end{eqnarray}
where </p>
<p>$$
\bar{\mathbf{\beta}} = \frac{1}{NT} \sum_{t=1}^{T} \sum_{i=1}^{N} \mathbf{\beta}_{it} 
$$
and
$$
\bar{r} = \frac{1}{NT} \sum_{t=1}^{T} \sum_{i=1}^{N} r_{it} 
$$ </p>
<p>The variance-covariance matrix of the factor premium estimate is given as:</p>
<p>\begin{eqnarray}
\hat{V}(\hat{f}) &amp;=&amp; \hat{\sigma}^2 
\left(
 \sum_{t=1}^T \sum_{i=1}^N<br />
  (\mathbf{\beta}_{it} - \bar{\mathbf{\beta}} ) 
  (  \mathbf{\beta}_{it} - \bar{\mathbf{\beta}} )^T
\right)
\end{eqnarray}</p>
<p>where $\hat{\sigma}^2$ is the variance of the error term $\epsilon_{it}$
$$
\hat{\sigma}^2 = \frac{1}{NT} \sum_{t=1}^T \sum_{i=1}^N<br />
 (r_{it} - \mathbf{\beta}_{it}\hat{f})
$$</p>
<h2>Robustness Considerations</h2>
<p>It is important that the estimates of the factor premium and 
the variance of factor premiums are robust. One way to accomplish
that is by  using generalized least squares (GLS). 
Corrections for heteroskedasticity and autocorrelation can be
incorporated by using the <a href="https://en.wikipedia.org/wiki/Newey%E2%80%93West_estimator">Newey-West Estimator</a> to correct for heteroskedacity and auto correlation.
The statistical package R has an implementation of Newey-West in the 
<a href="http://cran.r-project.org/web/packages/sandwich/index.html">sandwich</a> package.
<a href="http://www.ledoit.net/honey.pdf">Covariance Shrinkage</a> was suggested by Ledoit
and Wolf as a way to reduce estimation error in the Covariance Matrix. This technique
helps reduce the extremes in the covariance matrix coefficients towards a 
central value, and is necessary in the portfolio optimization process. </p>
<h2>Conclusions</h2>
<p>Here we gave an introduction to the process of building a factor model. This text
is informative for some one to get started. There are lots of nuances that one 
needs to consider to incorporate the intuition of investment managers and 
follow the wind as the market currents change.</p>
<h2>Further Reading</h2>
<ol>
<li>Ludwig B. Chincarini &amp; Daehwan Kim, <em>Quantitative Equity Portfolio Management</em>, McGraw Hill</li>
<li>Olivier Ledoit &amp; Michael Wolf, <em>Honey, I Shrunk the Sample Covariance Matrix</em>, <a href="http://www.ledoit.net/honey.pdf">http://www.ledoit.net/honey.pdf</a></li>
</ol>
     <br>
     
     <!-- article tags-->
        <span class="glyphicon glyphicon-tags"></span>&nbsp;&nbsp;
            <span class="label label-default"><a href="http://gouthamanbalaraman.com/tag/finance.html">finance</a></span>&nbsp;&nbsp;
        <br>
     <hr/>
    
    <strong>Related Post</strong>
        <ul>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/option-model-handbook-part-I-introduction-to-option-models.html">Option Model Handbook, Part I: Introduction to Option Models</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/value-options-commodity-futures-black-formula-quantlib-python.html">Valuing Options on Commodity Futures Using the Black Formula</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/modern-portfolio-theory-statistics.html">Modern Portfolio Theory Statistics</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/short-interest-rate-model-calibration-quantlib.html">Short Interest Rate Model Calibration</a>
            </li>
            <li>
                <a href="http://gouthamanbalaraman.com/blog/valuing-european-option-heston-model-quantLib.html">Valuing European Option Using the Heston Model in QuantLib and Python</a>
            </li>
        </ul>
        <hr/>

     <!-- article comments -->
    <div class="comment">
        <div id="disqus_thread"></div> <!-- comment app container -->
    </div>
	<!-- Comment BEGIN -->
    <script type="text/javascript">
        var disqus_shortname = 'gouthamanbalaramancom'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
     <!-- Comment END -->
</div>    
                </div>
               
            </div>
            <div class="row">
                <div class="col-md-10 col-md-offset-1">
                </div>
            </div>
            <footer id="contentinfo" class="footer">
                <address id="about" class="vcard body">
                    &copy; <a href="http://gouthamanbalaraman.com">Goutham Balaraman</a> Proudly powered by <a href="http://getpelican.com/">Pelican</a>
                    <div class="pull-right">
                    	<a href="http://www.bloglovin.com/blog/14559547/?claim=cqravg9v4n2">Bloglovin</a>
			            <a href="http://gouthamanbalaraman.com/feeds/all.atom.xml">Atom</a>
			        &nbsp
			            <a href="http://gouthamanbalaraman.com/feeds/all.rss.xml">RSS</a>
		            </div>
                </address><!-- /#about -->
            </footer>
        </div><!-- container -->
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
        <script src="http://gouthamanbalaraman.com/theme/static/js/jquery.1.11.2.min.js"></script>
        <script src="http://gouthamanbalaraman.com/theme/static/js/bootstrap.min.js"></script>
        <script type="text/javascript">
	jQuery(document).ready(function($) {
	    $("div.collapseheader").click(function () {
	    $header = $(this).children("span").first();
	    $codearea = $(this).children(".input_area");
	    console.log($(this).children());
	    $codearea.slideToggle(500, function () {
	        $header.text(function () {
	            return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
	        });
	    });
	});
	});
	</script>
    </body>
</html>